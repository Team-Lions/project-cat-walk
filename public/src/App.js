import React from 'react';
import ReactDOM from 'react-dom';
import axios from 'axios';
import Overview from './Overview/Overview.jsx';
import Rating from './Ratings&Reviews/rating.jsx';
import token from '../../public/token.js'; // ^^^^^^ update to where your token is until we figure out how we're doing tokens

class App extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      productList: [],
      selectedProductId: null,
      productInfo: {},
      reviewData: {},
      starRating: 0,
      productStyles: [],
      selectedStyle: {}
    };
  }

  getProductList() {
    //request to get all products
    //returns a promise
    return axios.get('https://app-hrsei-api.herokuapp.com/api/fec2/hratx/products', {
      headers: {
        'Authorization': token
      }
    });
  }

  getProductInfo(productId) {
    //request to get all product info for specified product
    //returns a promise
    return axios.get(`https://app-hrsei-api.herokuapp.com/api/fec2/hratx/products/${productId}`, {
      headers: {
        'Authorization': token
      },
      params: {
        product_id: productId
      }
    });
  }

  getReviewMetaData(productId) {
    //request to get review metadata on a specified product
    //returns a promise
    return axios.get(`https://app-hrsei-api.herokuapp.com/api/fec2/hratx/reviews/meta`, {
      headers: {
        'Authorization': token
      },
      params: {
        product_id: productId
      }
    });
  }

  getStyles(productId) {
    //request to get all the styles available on single/specified product
    //returns a promise
    return axios.get(`https://app-hrsei-api.herokuapp.com/api/fec2/hratx/products/${productId}/styles`, {
      headers: {
        'Authorization': token
      },
      params: {
        product_id: productId
      }
    });
  }

  changeStyle(e) {//event handler function to be passed down to style selector.
    //when a new selection is made this will run and update the state as needed
  } //will probably need to update to be an event handler function for when a new product is selected
  //If time, these can all be performed in parallel bc they are all only dependent on productID


  changeProduct(productId, newState = {}) {
    newState.selectedProductId = productId;
    this.getProductInfo(productId).then(productInfo => {
      newState.productInfo = productInfo.data;
      return this.getReviewMetaData(newState.selectedProductId);
    }).then(reviewData => {
      newState.reviewData = reviewData.data; //calculate average review

      var num = 0;
      var denom = 0;

      for (var k in newState.reviewData.ratings) {
        num += Number.parseInt(k);
        denom += Number.parseInt(newState.reviewData.ratings[k]);
      } //don't want to divide by 0 incase there are no reviews


      if (denom === 0) {
        denom = 1;
      }

      newState.starRating = num / denom;
      return this.getStyles(newState.selectedProductId);
    }).then(styleData => {
      newState.productStyles = styleData.data.results;
      newState.selectedStyle = newState.productStyles[0];
      console.log('all data retrieved');
      this.setState(newState);
    }).catch(err => {
      console.log('Error retriving data: ', err);
    });
  }

  componentDidMount() {
    //what does it mean "selects the page of results to return" in Products API page/do we even need to worry about that?
    //bascially the same as changing the selected product, but has to retrieve product list at the outset
    var newState = {};
    this.getProductList().then(products => {
      newState.productList = products.data;
      this.changeProduct(newState.productList[0].id, newState);
    }).catch(err => {
      console.log('Error retriving product List: ', err);
    });
  }

  render() {
    console.log('state: ', this.state);
    return /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement(Overview, {
      style: this.state.selectedStyle,
      productStyles: this.state.productStyles
    }), /*#__PURE__*/React.createElement(Rating, null));
  }

}

;
export default App;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2NsaWVudC9zcmMvQXBwLmpzeCJdLCJuYW1lcyI6WyJSZWFjdCIsIlJlYWN0RE9NIiwiYXhpb3MiLCJPdmVydmlldyIsIlJhdGluZyIsInRva2VuIiwiQXBwIiwiQ29tcG9uZW50IiwiY29uc3RydWN0b3IiLCJwcm9wcyIsInN0YXRlIiwicHJvZHVjdExpc3QiLCJzZWxlY3RlZFByb2R1Y3RJZCIsInByb2R1Y3RJbmZvIiwicmV2aWV3RGF0YSIsInN0YXJSYXRpbmciLCJwcm9kdWN0U3R5bGVzIiwic2VsZWN0ZWRTdHlsZSIsImdldFByb2R1Y3RMaXN0IiwiZ2V0IiwiaGVhZGVycyIsImdldFByb2R1Y3RJbmZvIiwicHJvZHVjdElkIiwicGFyYW1zIiwicHJvZHVjdF9pZCIsImdldFJldmlld01ldGFEYXRhIiwiZ2V0U3R5bGVzIiwiY2hhbmdlU3R5bGUiLCJlIiwiY2hhbmdlUHJvZHVjdCIsIm5ld1N0YXRlIiwidGhlbiIsImRhdGEiLCJudW0iLCJkZW5vbSIsImsiLCJyYXRpbmdzIiwiTnVtYmVyIiwicGFyc2VJbnQiLCJzdHlsZURhdGEiLCJyZXN1bHRzIiwiY29uc29sZSIsImxvZyIsInNldFN0YXRlIiwiY2F0Y2giLCJlcnIiLCJjb21wb25lbnREaWRNb3VudCIsInByb2R1Y3RzIiwiaWQiLCJyZW5kZXIiXSwibWFwcGluZ3MiOiJBQUFBLE9BQU9BLEtBQVAsTUFBa0IsT0FBbEI7QUFDQSxPQUFPQyxRQUFQLE1BQXFCLFdBQXJCO0FBQ0EsT0FBT0MsS0FBUCxNQUFrQixPQUFsQjtBQUNBLE9BQU9DLFFBQVAsTUFBcUIseUJBQXJCO0FBQ0EsT0FBT0MsTUFBUCxNQUFtQiw4QkFBbkI7QUFDQSxPQUFPQyxLQUFQLE1BQWtCLHVCQUFsQixDLENBQ0E7O0FBRUEsTUFBTUMsR0FBTixTQUFrQk4sS0FBSyxDQUFDTyxTQUF4QixDQUFrQztBQUNoQ0MsRUFBQUEsV0FBVyxDQUFDQyxLQUFELEVBQVE7QUFDakIsVUFBTUEsS0FBTjtBQUNBLFNBQUtDLEtBQUwsR0FBYTtBQUNYQyxNQUFBQSxXQUFXLEVBQUUsRUFERjtBQUVYQyxNQUFBQSxpQkFBaUIsRUFBRSxJQUZSO0FBR1hDLE1BQUFBLFdBQVcsRUFBRSxFQUhGO0FBSVhDLE1BQUFBLFVBQVUsRUFBRSxFQUpEO0FBS1hDLE1BQUFBLFVBQVUsRUFBRSxDQUxEO0FBTVhDLE1BQUFBLGFBQWEsRUFBRSxFQU5KO0FBT1hDLE1BQUFBLGFBQWEsRUFBRTtBQVBKLEtBQWI7QUFTRDs7QUFFREMsRUFBQUEsY0FBYyxHQUFHO0FBQ2Y7QUFDQTtBQUNBLFdBQU9oQixLQUFLLENBQUNpQixHQUFOLENBQVUsNkRBQVYsRUFBeUU7QUFDOUVDLE1BQUFBLE9BQU8sRUFBRTtBQUNQLHlCQUFpQmY7QUFEVjtBQURxRSxLQUF6RSxDQUFQO0FBS0Q7O0FBRURnQixFQUFBQSxjQUFjLENBQUNDLFNBQUQsRUFBWTtBQUN4QjtBQUNBO0FBQ0EsV0FBT3BCLEtBQUssQ0FBQ2lCLEdBQU4sQ0FBVywrREFBOERHLFNBQVUsRUFBbkYsRUFBcUY7QUFDMUZGLE1BQUFBLE9BQU8sRUFBRTtBQUNQLHlCQUFpQmY7QUFEVixPQURpRjtBQUkxRmtCLE1BQUFBLE1BQU0sRUFBRTtBQUNOQyxRQUFBQSxVQUFVLEVBQUVGO0FBRE47QUFKa0YsS0FBckYsQ0FBUDtBQVFEOztBQUVERyxFQUFBQSxpQkFBaUIsQ0FBQ0gsU0FBRCxFQUFZO0FBQzNCO0FBQ0E7QUFDQSxXQUFPcEIsS0FBSyxDQUFDaUIsR0FBTixDQUFXLGlFQUFYLEVBQTZFO0FBQ2xGQyxNQUFBQSxPQUFPLEVBQUU7QUFDUCx5QkFBaUJmO0FBRFYsT0FEeUU7QUFJbEZrQixNQUFBQSxNQUFNLEVBQUU7QUFDTkMsUUFBQUEsVUFBVSxFQUFFRjtBQUROO0FBSjBFLEtBQTdFLENBQVA7QUFRRDs7QUFFREksRUFBQUEsU0FBUyxDQUFDSixTQUFELEVBQVk7QUFDbkI7QUFDQTtBQUNBLFdBQU9wQixLQUFLLENBQUNpQixHQUFOLENBQVcsK0RBQThERyxTQUFVLFNBQW5GLEVBQTZGO0FBQ2xHRixNQUFBQSxPQUFPLEVBQUU7QUFDUCx5QkFBaUJmO0FBRFYsT0FEeUY7QUFJbEdrQixNQUFBQSxNQUFNLEVBQUU7QUFDTkMsUUFBQUEsVUFBVSxFQUFFRjtBQUROO0FBSjBGLEtBQTdGLENBQVA7QUFRRDs7QUFFREssRUFBQUEsV0FBVyxDQUFDQyxDQUFELEVBQUksQ0FDYjtBQUNBO0FBQ0QsR0FsRStCLENBb0VoQztBQUNBOzs7QUFDQUMsRUFBQUEsYUFBYSxDQUFDUCxTQUFELEVBQVlRLFFBQVEsR0FBRyxFQUF2QixFQUEyQjtBQUN0Q0EsSUFBQUEsUUFBUSxDQUFDbEIsaUJBQVQsR0FBNkJVLFNBQTdCO0FBQ0EsU0FBS0QsY0FBTCxDQUFvQkMsU0FBcEIsRUFDQ1MsSUFERCxDQUNPbEIsV0FBRCxJQUFpQjtBQUNyQmlCLE1BQUFBLFFBQVEsQ0FBQ2pCLFdBQVQsR0FBdUJBLFdBQVcsQ0FBQ21CLElBQW5DO0FBQ0EsYUFBTyxLQUFLUCxpQkFBTCxDQUF1QkssUUFBUSxDQUFDbEIsaUJBQWhDLENBQVA7QUFDRCxLQUpELEVBS0NtQixJQUxELENBS09qQixVQUFELElBQWdCO0FBQ3BCZ0IsTUFBQUEsUUFBUSxDQUFDaEIsVUFBVCxHQUFzQkEsVUFBVSxDQUFDa0IsSUFBakMsQ0FEb0IsQ0FFcEI7O0FBQ0EsVUFBSUMsR0FBRyxHQUFHLENBQVY7QUFDQSxVQUFJQyxLQUFLLEdBQUcsQ0FBWjs7QUFDQSxXQUFLLElBQUlDLENBQVQsSUFBY0wsUUFBUSxDQUFDaEIsVUFBVCxDQUFvQnNCLE9BQWxDLEVBQTJDO0FBQ3pDSCxRQUFBQSxHQUFHLElBQUlJLE1BQU0sQ0FBQ0MsUUFBUCxDQUFnQkgsQ0FBaEIsQ0FBUDtBQUNBRCxRQUFBQSxLQUFLLElBQUlHLE1BQU0sQ0FBQ0MsUUFBUCxDQUFnQlIsUUFBUSxDQUFDaEIsVUFBVCxDQUFvQnNCLE9BQXBCLENBQTRCRCxDQUE1QixDQUFoQixDQUFUO0FBQ0QsT0FSbUIsQ0FTcEI7OztBQUNBLFVBQUlELEtBQUssS0FBSyxDQUFkLEVBQWlCO0FBQ2ZBLFFBQUFBLEtBQUssR0FBRyxDQUFSO0FBQ0Q7O0FBQ0RKLE1BQUFBLFFBQVEsQ0FBQ2YsVUFBVCxHQUFzQmtCLEdBQUcsR0FBR0MsS0FBNUI7QUFDQSxhQUFPLEtBQUtSLFNBQUwsQ0FBZUksUUFBUSxDQUFDbEIsaUJBQXhCLENBQVA7QUFDRCxLQXBCRCxFQXFCQ21CLElBckJELENBcUJPUSxTQUFELElBQWU7QUFDbkJULE1BQUFBLFFBQVEsQ0FBQ2QsYUFBVCxHQUF5QnVCLFNBQVMsQ0FBQ1AsSUFBVixDQUFlUSxPQUF4QztBQUNBVixNQUFBQSxRQUFRLENBQUNiLGFBQVQsR0FBeUJhLFFBQVEsQ0FBQ2QsYUFBVCxDQUF1QixDQUF2QixDQUF6QjtBQUNBeUIsTUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVksb0JBQVo7QUFDQSxXQUFLQyxRQUFMLENBQWNiLFFBQWQ7QUFDRCxLQTFCRCxFQTJCQ2MsS0EzQkQsQ0EyQlFDLEdBQUQsSUFBUztBQUNkSixNQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWSx3QkFBWixFQUFzQ0csR0FBdEM7QUFDRCxLQTdCRDtBQThCRDs7QUFFREMsRUFBQUEsaUJBQWlCLEdBQUc7QUFDbEI7QUFDQTtBQUNBLFFBQUloQixRQUFRLEdBQUcsRUFBZjtBQUNBLFNBQUtaLGNBQUwsR0FDQ2EsSUFERCxDQUNPZ0IsUUFBRCxJQUFjO0FBQ2xCakIsTUFBQUEsUUFBUSxDQUFDbkIsV0FBVCxHQUF1Qm9DLFFBQVEsQ0FBQ2YsSUFBaEM7QUFDQSxXQUFLSCxhQUFMLENBQW1CQyxRQUFRLENBQUNuQixXQUFULENBQXFCLENBQXJCLEVBQXdCcUMsRUFBM0MsRUFBK0NsQixRQUEvQztBQUNELEtBSkQsRUFLQ2MsS0FMRCxDQUtRQyxHQUFELElBQVM7QUFDZEosTUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVksZ0NBQVosRUFBOENHLEdBQTlDO0FBQ0QsS0FQRDtBQVFEOztBQUVESSxFQUFBQSxNQUFNLEdBQUc7QUFDUFIsSUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVksU0FBWixFQUF1QixLQUFLaEMsS0FBNUI7QUFDQSx3QkFDRSw4Q0FDRSxvQkFBQyxRQUFEO0FBQVUsTUFBQSxLQUFLLEVBQUUsS0FBS0EsS0FBTCxDQUFXTyxhQUE1QjtBQUEyQyxNQUFBLGFBQWEsRUFBRSxLQUFLUCxLQUFMLENBQVdNO0FBQXJFLE1BREYsZUFFRSxvQkFBQyxNQUFELE9BRkYsQ0FERjtBQU1EOztBQTlIK0I7O0FBK0hqQztBQUVELGVBQWVWLEdBQWYiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IFJlYWN0RE9NIGZyb20gJ3JlYWN0LWRvbSc7XG5pbXBvcnQgYXhpb3MgZnJvbSAnYXhpb3MnO1xuaW1wb3J0IE92ZXJ2aWV3IGZyb20gJy4vT3ZlcnZpZXcvT3ZlcnZpZXcuanN4JztcbmltcG9ydCBSYXRpbmcgZnJvbSAnLi9SYXRpbmdzJlJldmlld3MvcmF0aW5nLmpzeCc7XG5pbXBvcnQgdG9rZW4gZnJvbSAnLi4vLi4vcHVibGljL3Rva2VuLmpzJztcbi8vIF5eXl5eXiB1cGRhdGUgdG8gd2hlcmUgeW91ciB0b2tlbiBpcyB1bnRpbCB3ZSBmaWd1cmUgb3V0IGhvdyB3ZSdyZSBkb2luZyB0b2tlbnNcblxuY2xhc3MgQXBwIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcbiAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICBzdXBlcihwcm9wcyk7XG4gICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgIHByb2R1Y3RMaXN0OiBbXSxcbiAgICAgIHNlbGVjdGVkUHJvZHVjdElkOiBudWxsLFxuICAgICAgcHJvZHVjdEluZm86IHt9LFxuICAgICAgcmV2aWV3RGF0YToge30sXG4gICAgICBzdGFyUmF0aW5nOiAwLFxuICAgICAgcHJvZHVjdFN0eWxlczogW10sXG4gICAgICBzZWxlY3RlZFN0eWxlOiB7fVxuICAgIH1cbiAgfVxuXG4gIGdldFByb2R1Y3RMaXN0KCkge1xuICAgIC8vcmVxdWVzdCB0byBnZXQgYWxsIHByb2R1Y3RzXG4gICAgLy9yZXR1cm5zIGEgcHJvbWlzZVxuICAgIHJldHVybiBheGlvcy5nZXQoJ2h0dHBzOi8vYXBwLWhyc2VpLWFwaS5oZXJva3VhcHAuY29tL2FwaS9mZWMyL2hyYXR4L3Byb2R1Y3RzJywge1xuICAgICAgaGVhZGVyczoge1xuICAgICAgICAnQXV0aG9yaXphdGlvbic6IHRva2VuXG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgZ2V0UHJvZHVjdEluZm8ocHJvZHVjdElkKSB7XG4gICAgLy9yZXF1ZXN0IHRvIGdldCBhbGwgcHJvZHVjdCBpbmZvIGZvciBzcGVjaWZpZWQgcHJvZHVjdFxuICAgIC8vcmV0dXJucyBhIHByb21pc2VcbiAgICByZXR1cm4gYXhpb3MuZ2V0KGBodHRwczovL2FwcC1ocnNlaS1hcGkuaGVyb2t1YXBwLmNvbS9hcGkvZmVjMi9ocmF0eC9wcm9kdWN0cy8ke3Byb2R1Y3RJZH1gLHtcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ0F1dGhvcml6YXRpb24nOiB0b2tlblxuICAgICAgfSxcbiAgICAgIHBhcmFtczoge1xuICAgICAgICBwcm9kdWN0X2lkOiBwcm9kdWN0SWRcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGdldFJldmlld01ldGFEYXRhKHByb2R1Y3RJZCkge1xuICAgIC8vcmVxdWVzdCB0byBnZXQgcmV2aWV3IG1ldGFkYXRhIG9uIGEgc3BlY2lmaWVkIHByb2R1Y3RcbiAgICAvL3JldHVybnMgYSBwcm9taXNlXG4gICAgcmV0dXJuIGF4aW9zLmdldChgaHR0cHM6Ly9hcHAtaHJzZWktYXBpLmhlcm9rdWFwcC5jb20vYXBpL2ZlYzIvaHJhdHgvcmV2aWV3cy9tZXRhYCwge1xuICAgICAgaGVhZGVyczoge1xuICAgICAgICAnQXV0aG9yaXphdGlvbic6IHRva2VuXG4gICAgICB9LFxuICAgICAgcGFyYW1zOiB7XG4gICAgICAgIHByb2R1Y3RfaWQ6IHByb2R1Y3RJZFxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgZ2V0U3R5bGVzKHByb2R1Y3RJZCkge1xuICAgIC8vcmVxdWVzdCB0byBnZXQgYWxsIHRoZSBzdHlsZXMgYXZhaWxhYmxlIG9uIHNpbmdsZS9zcGVjaWZpZWQgcHJvZHVjdFxuICAgIC8vcmV0dXJucyBhIHByb21pc2VcbiAgICByZXR1cm4gYXhpb3MuZ2V0KGBodHRwczovL2FwcC1ocnNlaS1hcGkuaGVyb2t1YXBwLmNvbS9hcGkvZmVjMi9ocmF0eC9wcm9kdWN0cy8ke3Byb2R1Y3RJZH0vc3R5bGVzYCwge1xuICAgICAgaGVhZGVyczoge1xuICAgICAgICAnQXV0aG9yaXphdGlvbic6IHRva2VuXG4gICAgICB9LFxuICAgICAgcGFyYW1zOiB7XG4gICAgICAgIHByb2R1Y3RfaWQ6IHByb2R1Y3RJZFxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgY2hhbmdlU3R5bGUoZSkge1xuICAgIC8vZXZlbnQgaGFuZGxlciBmdW5jdGlvbiB0byBiZSBwYXNzZWQgZG93biB0byBzdHlsZSBzZWxlY3Rvci5cbiAgICAvL3doZW4gYSBuZXcgc2VsZWN0aW9uIGlzIG1hZGUgdGhpcyB3aWxsIHJ1biBhbmQgdXBkYXRlIHRoZSBzdGF0ZSBhcyBuZWVkZWRcbiAgfVxuXG4gIC8vd2lsbCBwcm9iYWJseSBuZWVkIHRvIHVwZGF0ZSB0byBiZSBhbiBldmVudCBoYW5kbGVyIGZ1bmN0aW9uIGZvciB3aGVuIGEgbmV3IHByb2R1Y3QgaXMgc2VsZWN0ZWRcbiAgLy9JZiB0aW1lLCB0aGVzZSBjYW4gYWxsIGJlIHBlcmZvcm1lZCBpbiBwYXJhbGxlbCBiYyB0aGV5IGFyZSBhbGwgb25seSBkZXBlbmRlbnQgb24gcHJvZHVjdElEXG4gIGNoYW5nZVByb2R1Y3QocHJvZHVjdElkLCBuZXdTdGF0ZSA9IHt9KSB7XG4gICAgbmV3U3RhdGUuc2VsZWN0ZWRQcm9kdWN0SWQgPSBwcm9kdWN0SWQ7XG4gICAgdGhpcy5nZXRQcm9kdWN0SW5mbyhwcm9kdWN0SWQpXG4gICAgLnRoZW4oKHByb2R1Y3RJbmZvKSA9PiB7XG4gICAgICBuZXdTdGF0ZS5wcm9kdWN0SW5mbyA9IHByb2R1Y3RJbmZvLmRhdGE7XG4gICAgICByZXR1cm4gdGhpcy5nZXRSZXZpZXdNZXRhRGF0YShuZXdTdGF0ZS5zZWxlY3RlZFByb2R1Y3RJZCk7XG4gICAgfSlcbiAgICAudGhlbigocmV2aWV3RGF0YSkgPT4ge1xuICAgICAgbmV3U3RhdGUucmV2aWV3RGF0YSA9IHJldmlld0RhdGEuZGF0YTtcbiAgICAgIC8vY2FsY3VsYXRlIGF2ZXJhZ2UgcmV2aWV3XG4gICAgICB2YXIgbnVtID0gMDtcbiAgICAgIHZhciBkZW5vbSA9IDA7XG4gICAgICBmb3IgKHZhciBrIGluIG5ld1N0YXRlLnJldmlld0RhdGEucmF0aW5ncykge1xuICAgICAgICBudW0gKz0gTnVtYmVyLnBhcnNlSW50KGspO1xuICAgICAgICBkZW5vbSArPSBOdW1iZXIucGFyc2VJbnQobmV3U3RhdGUucmV2aWV3RGF0YS5yYXRpbmdzW2tdKTtcbiAgICAgIH1cbiAgICAgIC8vZG9uJ3Qgd2FudCB0byBkaXZpZGUgYnkgMCBpbmNhc2UgdGhlcmUgYXJlIG5vIHJldmlld3NcbiAgICAgIGlmIChkZW5vbSA9PT0gMCkge1xuICAgICAgICBkZW5vbSA9IDE7XG4gICAgICB9XG4gICAgICBuZXdTdGF0ZS5zdGFyUmF0aW5nID0gbnVtIC8gZGVub207XG4gICAgICByZXR1cm4gdGhpcy5nZXRTdHlsZXMobmV3U3RhdGUuc2VsZWN0ZWRQcm9kdWN0SWQpO1xuICAgIH0pXG4gICAgLnRoZW4oKHN0eWxlRGF0YSkgPT4ge1xuICAgICAgbmV3U3RhdGUucHJvZHVjdFN0eWxlcyA9IHN0eWxlRGF0YS5kYXRhLnJlc3VsdHM7XG4gICAgICBuZXdTdGF0ZS5zZWxlY3RlZFN0eWxlID0gbmV3U3RhdGUucHJvZHVjdFN0eWxlc1swXTtcbiAgICAgIGNvbnNvbGUubG9nKCdhbGwgZGF0YSByZXRyaWV2ZWQnKTtcbiAgICAgIHRoaXMuc2V0U3RhdGUobmV3U3RhdGUpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKCdFcnJvciByZXRyaXZpbmcgZGF0YTogJywgZXJyKTtcbiAgICB9KVxuICB9XG5cbiAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgLy93aGF0IGRvZXMgaXQgbWVhbiBcInNlbGVjdHMgdGhlIHBhZ2Ugb2YgcmVzdWx0cyB0byByZXR1cm5cIiBpbiBQcm9kdWN0cyBBUEkgcGFnZS9kbyB3ZSBldmVuIG5lZWQgdG8gd29ycnkgYWJvdXQgdGhhdD9cbiAgICAvL2Jhc2NpYWxseSB0aGUgc2FtZSBhcyBjaGFuZ2luZyB0aGUgc2VsZWN0ZWQgcHJvZHVjdCwgYnV0IGhhcyB0byByZXRyaWV2ZSBwcm9kdWN0IGxpc3QgYXQgdGhlIG91dHNldFxuICAgIHZhciBuZXdTdGF0ZSA9IHt9O1xuICAgIHRoaXMuZ2V0UHJvZHVjdExpc3QoKVxuICAgIC50aGVuKChwcm9kdWN0cykgPT4ge1xuICAgICAgbmV3U3RhdGUucHJvZHVjdExpc3QgPSBwcm9kdWN0cy5kYXRhO1xuICAgICAgdGhpcy5jaGFuZ2VQcm9kdWN0KG5ld1N0YXRlLnByb2R1Y3RMaXN0WzBdLmlkLCBuZXdTdGF0ZSk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5sb2coJ0Vycm9yIHJldHJpdmluZyBwcm9kdWN0IExpc3Q6ICcsIGVycik7XG4gICAgfSk7XG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc29sZS5sb2coJ3N0YXRlOiAnLCB0aGlzLnN0YXRlKTtcbiAgICByZXR1cm4gKFxuICAgICAgPGRpdj5cbiAgICAgICAgPE92ZXJ2aWV3IHN0eWxlPXt0aGlzLnN0YXRlLnNlbGVjdGVkU3R5bGV9IHByb2R1Y3RTdHlsZXM9e3RoaXMuc3RhdGUucHJvZHVjdFN0eWxlc30vPlxuICAgICAgICA8UmF0aW5nIC8+XG4gICAgICA8L2Rpdj5cbiAgICApO1xuICB9XG59O1xuXG5leHBvcnQgZGVmYXVsdCBBcHA7Il19